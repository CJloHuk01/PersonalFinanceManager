<UserControl x:Class="PersonalFinanceManager.Views.TransactionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:PersonalFinanceManager.ViewModels"
             xmlns:converters="clr-namespace:PersonalFinanceManager.Converters"
             xmlns:system="clr-namespace:System;assembly=mscorlib"
             xmlns:local="clr-namespace:PersonalFinanceManager"
             xmlns:enums="clr-namespace:PersonalFinanceManager.Enum"
>

    <UserControl.Resources>
        <converters:AmountToColorConverter x:Key="AmountToColorConverter"/>

        <ObjectDataProvider x:Key="TransactionTypeValues"
                            MethodName="GetValues"
                            ObjectType="{x:Type system:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="enums:TransactionType"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </UserControl.Resources>

    <!--<UserControl.DataContext>
        <vm:TransactionsViewModel />
    </UserControl.DataContext>-->

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="#F5F5F5" Padding="15" Margin="0,0,0,10">
            <StackPanel>
                <TextBlock Text="Добавить транзакцию:" 
                           FontWeight="Bold" 
                           FontSize="16"
                           Margin="0,0,0,10"/>

                <StackPanel Orientation="Horizontal">
                    <ComboBox ItemsSource="{Binding Source={StaticResource TransactionTypeValues}}"
                              SelectedItem="{Binding TransactionType}"
                              Width="100"
                              Margin="0,0,10,0"
                              VerticalAlignment="Center">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <Binding Path="." StringFormat="{}{0}"/>
                                    </TextBlock.Text>
                                </TextBlock>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>

                    <TextBox Text="{Binding TransactionAmount, StringFormat=N2}"
                             Width="100"
                             Margin="0,0,10,0"
                             VerticalAlignment="Center"
                             Padding="5"/>

                    <DatePicker SelectedDate="{Binding TransactionDate}"
                                Width="120"
                                Margin="0,0,10,0"
                                VerticalAlignment="Center"/>

                    <ComboBox ItemsSource="{Binding Accounts}"
                              SelectedItem="{Binding SelectedAccount}"
                              DisplayMemberPath="Name"
                              Width="150"
                              Margin="0,0,10,0"
                              VerticalAlignment="Center"/>

                    <ComboBox ItemsSource="{Binding FilteredCategories}"
                              SelectedItem="{Binding SelectedCategory}"
                              DisplayMemberPath="Name"
                              Width="150"
                              Margin="0,0,10,0"
                              VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                    <TextBox Text="{Binding TransactionDescription}"
                             Width="300"
                             Margin="0,0,10,0"
                             VerticalAlignment="Center"
                             Padding="5"
                             TextWrapping="Wrap"/>

                    <Button Content="Добавить транзакцию"
                            Command="{Binding AddTransactionCommand}"
                            Padding="15,5"
                            Background="#4CAF50"
                            Foreground="White"
                            FontWeight="Bold"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Transactions}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White" 
                                BorderBrush="#E0E0E0" 
                                BorderThickness="0,0,0,1" 
                                Padding="10,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0" 
                                           Text="{Binding Date, StringFormat=dd.MM.yyyy HH:mm}"
                                           FontSize="12"
                                           Foreground="Gray"
                                           VerticalAlignment="Center"
                                           Width="120"
                                           Margin="0,0,10,0"/>

                                <TextBlock Grid.Column="1" 
                                           Text="{Binding Description}"
                                           FontSize="14"
                                           VerticalAlignment="Center"
                                           Margin="10,0"
                                           TextWrapping="Wrap"/>

                                <Border Grid.Column="2" 
                                        Background="{Binding Category.Color}"
                                        Padding="5,2"
                                        CornerRadius="3"
                                        Margin="10,0,10,0"
                                        VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Category.Name}" 
                                               FontSize="12"
                                               Foreground="White"
                                               FontWeight="SemiBold"/>
                                </Border>

                                <TextBlock Grid.Column="3" 
                                           Text="{Binding Account.Name}"
                                           FontSize="12"
                                           Foreground="Gray"
                                           VerticalAlignment="Center"
                                           Margin="10,0,15,0"/>

                                <TextBlock Grid.Column="4" 
                                           Text="{Binding TransactionType}"
                                           FontSize="12"
                                           Foreground="Gray"
                                           VerticalAlignment="Center"
                                           Margin="10,0,15,0"/>

                                <TextBlock Grid.Column="5" 
                                           Text="{Binding Amount, StringFormat={}{0:N2}}"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Margin="0,0,15,0"
                                           Foreground="{Binding TransactionType, Converter={StaticResource AmountToColorConverter}}"/>

                                <Button Grid.Column="6" 
                                        Content="Удалить" 
                                        Command="{Binding DataContext.DeleteTransactionCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Background="#F44336" 
                                        Foreground="White"
                                        BorderThickness="0"
                                        Padding="8,3"
                                        FontSize="11"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>